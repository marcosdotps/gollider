name: Create doc issues

on:
  workflow_dispatch:

permissions:
  issues: write

jobs:
  create-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Create doc issues 1-30
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // Fetch all open and closed issues to detect existing ones
            const existingTitles = new Set();
            for await (const response of github.paginate.iterator(
              github.rest.issues.listForRepo,
              { owner, repo, state: 'all', per_page: 100 }
            )) {
              for (const issue of response.data) {
                existingTitles.add(issue.title);
              }
            }

            for (let i = 1; i <= 30; i++) {
              const title = `Añadir fichero doc-${i}.md`;
              if (existingTitles.has(title)) {
                core.info(`Issue already exists: ${title} — skipping`);
                continue;
              }
              const body = [
                `Añadir un documento llamado \`doc-${i}.md\` en el directorio \`docs/\` con el contenido que deseen.`,
                '',
                'Es fundamental que el contenido sea apropiado y seguro para todos los públicos (safe for work), ya que este repositorio es una demo pública.'
              ].join('\n');

              await github.rest.issues.create({ owner, repo, title, body });
              core.info(`Created issue: ${title}`);
            }
